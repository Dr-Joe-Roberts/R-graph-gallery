<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Google Analytics + AdThrive -->

<!-- AdThrive Head Tag Manual -->
<script data-no-optimize="1" data-cfasync="false">
    (function(w, d) {
    w.adthrive = w.adthrive || {};
    w.adthrive.cmd = w.
    adthrive.cmd || [];
    w.adthrive.plugin = 'adthrive-ads-manual';
    w.adthrive.host = 'ads.adthrive.com';var s = d.createElement('script');
    s.async = true;
    s.referrerpolicy='no-referrer-when-downgrade';
    s.src = 'https://' + w.adthrive.host + '/sites/6434363fc11d8059e61106b4/ads.min.js?referrer=' + w.encodeURIComponent(w.location.href) + '&cb=' + (Math.floor(Math.random() * 100) + 1);
    var n = d.getElementsByTagName('script')[0];
    n.parentNode.insertBefore(s, n);
    })(window, document);
</script>
<!-- End of AdThrive Head Tag -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-79254642-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-79254642-1');
  </script>



  <!-- Google Analytics + OutboundLink + Google Adsense -->


<meta charset="utf-8">
<title>Bubble map with ggplot2 &#8211; the R Graph Gallery</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This post explains how to build a bubble map with ggplot2. It takes a list of GPS coordinates and plot them on top of a map, with size and color mapped to data.">
<meta name="keywords" content="R,ggplot2,tidyverse,Example,Data,Dataviz,Datavisualization,Plot,Chart,Graph,Learning,Caveat,Pitfall,Mistake">
<meta name="author" content="Yan Holtz">
<link rel="icon" href="img/logo/R_single_small.png">

<!-- Control appearance when shared by social media -->
<meta property="og:title" content="Bubble map with ggplot2" />
<meta property="og:image" content="img/overview_RGG.png" />
<meta property="og:description" content="This post explains how to build a bubble map with ggplot2. It takes a list of GPS coordinates and plot them on top of a map, with size and color mapped to data." />
<meta property='og:url' content="https://www.r-graph-gallery.com/330-bubble-map-with-ggplot2.html" />
<meta property="og:type" content="website" />

<!-- Bootstrap core CSS -->
<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom fonts for this template -->
<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Custom styles for this template -->
<link href="css/agency.css" rel="stylesheet">

<!-- JQUERY -->
<script src="vendor/jquery/jquery.min.js"></script>

</head>





<body data-spy="scroll" data-target="#myScrollspy" data-offset="1">


<!-- THIS ALLOWS TO INSERT THE MENU THAT IS STORED IN A MENU.HTML FILE-->
<nav class="navbar navbar-expand-lg fixed-top" id="mainNav"></nav>
<script>
  $(function(){
    $("#mainNav").load("html_chunk/menu.html");
  });
</script>

<!-- THIS ALLOWS TO INSERT THE MODAL OF THE MENU THAT IS STORED IN A MENU_MODAL.HTML FILE-->
<div id="modal_menu_insertion"> </div>
<script>
  $(function(){
    $("#modal_menu_insertion").load("html_chunk/menu_modal.html");
  });
</script>



<!-- Header = Title in big + social media Icon + quick description -->
<header class="masthead" style="padding-bottom: 30px;">
  <div class="textlanding">
      <center><h1>Bubble map with ggplot2</h1></center>
      <hr class="short_hr">
      <br>
      <ul class="list-inline social-buttons">
        <li class="list-inline-item">
          <a href="https://twitter.com/R_Graph_Gallery">
            <i class="fa fa-twitter"></i>
          </a>
        </li>
        <li class="list-inline-item social-buttons">
          <a href="https://github.com/holtzy">
            <i class="fa fa-github" style="color: white"></i>
          </a>
        </li>
        <li class="list-inline-item social-buttons">
          <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
            <i class="fa fa-linkedin"></i>
          </a>
        </li>
        <li class="list-inline-item social-buttons">
          <a href="https://www.yan-holtz.com">
            <i class="fa fa-home"></i>
          </a>
        </li>
      </ul>
      <center><p style="max-width: 600px; margin-top: 40px">This post explains how to build a <a href="bubble-map.html">bubble map</a> with <a href="ggplot2-package.html">ggplot2</a>. It takes a list of GPS coordinates and plot them on top of a map, with size and color mapped to data.</p></center>
      <div style="text-align:center">
         <a class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger" href='bubble-map.html'>Bubble map section</a>
         <a class="btn btn-secondary btn-xl text-uppercase js-scroll-trigger" href='https://www.data-to-viz.com/graph/bubblemap.html'>About Maps</a>
      </div>
  </div>
</header>



<!-- THIS ALLOWS TO INSERT THE ADVERTISEMENT BANNER THAT IS STORED IN A BANNER.HTML FILE-->
<div id="position_for_images"></div>
<script>
  $(function(){
    $("#position_for_images").load("html_chunk/images.html");
  });
</script>










<!-- STYLE for chart pages but not the rest of tthe website -->
<style>
  img {
    margin-top: 20px;
  }
</style>



<div class="container" style="padding-top: 100px">
<div class="row">
<div class="col-md-6 col-sm-12 align-self-center">
<p><img src="img/graph/330-bubble-map-with-ggplot2.png" alt="bubble map with R and ggplot2" width="100%"></img></p>
</div>
<div class="col-md-6 col-sm-12 align-self-center">
<p>This post explains how to make a <a href="bubble-map.html">bubble map</a> with <a href="ggplot2-package.html">ggplot2</a>.</p>
<p>A bubble map is like a <a href="bubble-chart.html">bubble chart</a>, but with a map in the background. As input you need:</p>
<ul>
<li>a list of GPS coordinates (longitude and latitude of the places you want to represent)</li>
<li>a numeric variable used for bubble color and size</li>
</ul>
<p>This post provides a step-by-step approach to build the map beside, showing the 1000 biggest cities of the UK.</p>
<h1 id="load-data">Load data</h1>
<hr />
<p>The first step is to get the boundaries of the zone that interests you. Several option are available in R, as extensively described in the <a href="map.html">background map</a> section of the gallery.</p>
<p>Briefly, you can find this information somewhere under the <a href="168-load-a-shape-file-into-r.html">shapefile</a> format or under the <a href="325-background-map-from-geojson-format-in-r.html">geoJSON</a> format. You can also load google like backgrounds with the <a href="324-map-background-with-the-ggmap-library.html">ggmap</a> library.</p>
<p>This post uses the last approach: it loads the <code>maps</code> package that provides the boundaries of every world country.</p>
</div>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Libraries</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># Get the world polygon and extract UK</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">library</span>(maps)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">UK &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;world&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;UK&quot;</span>)</a></code></pre></div>
<p><br></p>
<p>The second step is to load a data frame with the info of the bubble you want to draw. The <code>maps</code> library provides a list of the biggest cities in the world. Letâ€™s use it to get information on the UK.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Get a data frame with longitude, latitude, and size of bubbles (a bubble = a city)</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">data &lt;-<span class="st"> </span>world.cities <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country.etc<span class="op">==</span><span class="st">&quot;UK&quot;</span>)</a></code></pre></div>
<h1 id="scatter">Basic scatterplot map</h1>
<hr />
<p><code>ggplot2</code> makes it a breeze to map both information on the same graph. Use <code>geom_polygon</code> for the shape of UK first, and add your scatterplot on it with <code>geom_point()</code>.</p>
<p>On the right figure, note the use of the <code>ggrepel</code> library to avoid overlapping between city names.</p>
<p><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode-1.png" width="50%" /><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode-2.png" width="50%" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Left chart</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>( <span class="dt">data=</span>data, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_map</span>() </a>
<a class="sourceLine" id="cb3-6" data-line-number="6"> </a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># Second graphic with names of the 10 biggest cities</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>( <span class="dt">data=</span>data, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">alpha=</span>pop)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_text_repel</span>( <span class="dt">data=</span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(pop) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>(<span class="dv">10</span>), <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">label=</span>name), <span class="dt">size=</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_point</span>( <span class="dt">data=</span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(pop) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>(<span class="dv">10</span>), <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_map</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<h1 id="bubble">Basic bubble map</h1>
<hr />
<p>Now we want to add another information. The number of inhabitant per city will be mapped to the colour and the size of the bubbles. Note that the order of city matters! It is advised to show the most important information on top (center). This can been done sorting your dataset before making the plot.</p>
<p><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode5-1.png" width="33%" /><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode5-2.png" width="33%" /><img src="330-bubble-map-with-ggplot2_files/figure-html/thecode5-3.png" width="33%" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># virids package for the color palette</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"> </a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># Left: use size and color</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>( <span class="dt">data=</span>data, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">size=</span>pop, <span class="dt">color=</span>pop)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_size_continuous</span>(<span class="dt">range=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_color_viridis</span>(<span class="dt">trans=</span><span class="st">&quot;log&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_map</span>() </a>
<a class="sourceLine" id="cb4-11" data-line-number="11"> </a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co"># Center: reorder your dataset first! Big cities appear later = on top</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="st"> </span><span class="kw">arrange</span>(pop) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="st"> </span><span class="kw">mutate</span>( <span class="dt">name=</span><span class="kw">factor</span>(name, <span class="kw">unique</span>(name))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="st">    </span><span class="kw">geom_point</span>( <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">size=</span>pop, <span class="dt">color=</span>pop), <span class="dt">alpha=</span><span class="fl">0.9</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="st">    </span><span class="kw">scale_size_continuous</span>(<span class="dt">range=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="st">    </span><span class="kw">scale_color_viridis</span>(<span class="dt">trans=</span><span class="st">&quot;log&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="st">    </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_map</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"> </a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co"># Right: just use arrange(desc(pop)) instead</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24">data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(pop)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="st"> </span><span class="kw">mutate</span>( <span class="dt">name=</span><span class="kw">factor</span>(name, <span class="kw">unique</span>(name))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="st">    </span><span class="kw">geom_point</span>( <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">size=</span>pop, <span class="dt">color=</span>pop), <span class="dt">alpha=</span><span class="fl">0.9</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="st">    </span><span class="kw">scale_size_continuous</span>(<span class="dt">range=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="st">    </span><span class="kw">scale_color_viridis</span>(<span class="dt">trans=</span><span class="st">&quot;log&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="st">    </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_map</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<h1 id="custom">Customized bubble map</h1>
<hr />
<div class="row">
<div class="col-md-6 col-sm-12 align-self-center">
<p><img src="img/graph/330-bubble-map-with-ggplot2.png" alt="bubble map with R and ggplot2" width="100%"></img></p>
</div>
<div class="col-md-6 col-sm-12 align-self-center">
<p>We can custom a little bit this figure for a better looking result (first image of this post).</p>
<p>Note that here the legend shows both the size, the color and the transparency on the same circles. This is possible only if these 3 informations are redondante, with the same name, transformation and breaks.</p>
</div>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Create breaks for the color scale</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">mybreaks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.02</span>, <span class="fl">0.04</span>, <span class="fl">0.08</span>, <span class="dv">1</span>, <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># Reorder data to show biggest cities on top</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(pop) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">name=</span><span class="kw">factor</span>(name, <span class="kw">unique</span>(name))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop=</span>pop<span class="op">/</span><span class="dv">1000000</span>) </a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co"># Build the map</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">map <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="st">    </span><span class="kw">geom_point</span>(  <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">size=</span>pop, <span class="dt">color=</span>pop, <span class="dt">alpha=</span>pop), <span class="dt">shape=</span><span class="dv">20</span>, <span class="dt">stroke=</span><span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">    </span><span class="kw">scale_size_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Population (in M)&quot;</span>, <span class="dt">trans=</span><span class="st">&quot;log&quot;</span>, <span class="dt">range=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">12</span>), <span class="dt">breaks=</span>mybreaks) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">    </span><span class="kw">scale_alpha_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Population (in M)&quot;</span>, <span class="dt">trans=</span><span class="st">&quot;log&quot;</span>, <span class="dt">range=</span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">.9</span>), <span class="dt">breaks=</span>mybreaks) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">    </span><span class="kw">scale_color_viridis</span>(<span class="dt">option=</span><span class="st">&quot;magma&quot;</span>, <span class="dt">trans=</span><span class="st">&quot;log&quot;</span>, <span class="dt">breaks=</span>mybreaks, <span class="dt">name=</span><span class="st">&quot;Population (in M)&quot;</span> ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="st">    </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_map</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="st">    </span><span class="kw">guides</span>( <span class="dt">colour =</span> <span class="kw">guide_legend</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;The 1000 biggest cities in the UK&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="st">    </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">      <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.85</span>, <span class="fl">0.8</span>),</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">      <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#22211d&quot;</span>),</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">      <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="dt">color =</span> <span class="ot">NA</span>), </a>
<a class="sourceLine" id="cb5-25" data-line-number="25">      <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="dt">color =</span> <span class="ot">NA</span>), </a>
<a class="sourceLine" id="cb5-26" data-line-number="26">      <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#f5f5f2&quot;</span>, <span class="dt">color =</span> <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb5-27" data-line-number="27">      <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span> <span class="dv">16</span>, <span class="dt">hjust=</span><span class="fl">0.1</span>, <span class="dt">color =</span> <span class="st">&quot;#4e4d47&quot;</span>, <span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dt">b =</span> <span class="fl">-0.1</span>, <span class="dt">t =</span> <span class="fl">0.4</span>, <span class="dt">l =</span> <span class="dv">2</span>, <span class="dt">unit =</span> <span class="st">&quot;cm&quot;</span>)),</a>
<a class="sourceLine" id="cb5-28" data-line-number="28">    )</a></code></pre></div>
<h1 id="interactive">Interactive bubble map with plotly</h1>
<hr />
<div class="row">
<div class="col-md-8 col-sm-12 align-self-center">
<center>
<iframe src="HtmlWidget/bubblemapUK.html" width="100%" height="600px" style="border:none">
</iframe>
</center>
</div>
<div class="col-md-4 col-sm-12 align-self-center">
<p>Last but not least, plotly allows to quickly get an interactive version. This is really handy since it allows to zoom on the map and hover a city to know its name and population!</p>
</div>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Load the plotly package</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">library</span>(plotly)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"> </a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co"># Rorder data + Add a new column with tooltip text</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(pop) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">name=</span><span class="kw">factor</span>(name, <span class="kw">unique</span>(name))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">mytext=</span><span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">    <span class="st">&quot;City: &quot;</span>, name, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    <span class="st">&quot;Population: &quot;</span>, pop, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"> </a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co"># Make the map (static)</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">p &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> UK, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">size=</span>pop, <span class="dt">color=</span>pop, <span class="dt">text=</span>mytext, <span class="dt">alpha=</span>pop) ) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">    </span><span class="kw">scale_size_continuous</span>(<span class="dt">range=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">    </span><span class="kw">scale_color_viridis</span>(<span class="dt">option=</span><span class="st">&quot;inferno&quot;</span>, <span class="dt">trans=</span><span class="st">&quot;log&quot;</span> ) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">    </span><span class="kw">scale_alpha_continuous</span>(<span class="dt">trans=</span><span class="st">&quot;log&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="st">    </span><span class="kw">theme_void</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">50</span>,<span class="dv">59</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="st">    </span><span class="kw">coord_map</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb6-25" data-line-number="25"> </a>
<a class="sourceLine" id="cb6-26" data-line-number="26">p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(p, <span class="dt">tooltip=</span><span class="st">&quot;text&quot;</span>)</a>
<a class="sourceLine" id="cb6-27" data-line-number="27">p</a>
<a class="sourceLine" id="cb6-28" data-line-number="28"></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co"># save the widget in a html file if needed.</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="co"># library(htmlwidgets)</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co"># saveWidget(p, file=paste0( getwd(), &quot;/HtmlWidget/bubblemapUK.html&quot;))</span></a></code></pre></div>
<!-- Close container -->
</div>
<!-- ============================ RELATED SECTION ============================ -->
<section class="bg-light" id="portfolio_landing" style="padding-top: 30px; padding-bottom: 30px; margin-top: 100px;">

<div class="container">

  <p class="mySeryTitle">Related chart types</p>
  <hr>
  <div class="row">
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Map150.png" alt="">
      </a>
      <div class="captionPortfolio">Map</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="choropleth-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Choropleth150.png" alt="">
      </a>
      <div class="captionPortfolio">Choropleth</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="hexbin-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/MapHexbin150.png" alt="">
      </a>
      <div class="captionPortfolio">Hexbin map</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="cartogram.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/Cartogram150.png" alt="">
      </a>
      <div class="captionPortfolio">Cartogram</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="connection-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/ConnectedMap150.png" alt="">
      </a>
      <div class="captionPortfolio">Connection</div>
    </div>
    <div class="col-md-2 col-sm-4 portfolio-item">
      <a class="portfolio-link"  href="bubble-map.html">
        <div class="portfolio-hover">
          <div class="portfolio-hover-content">
            <i class="fa fa-plus fa-3x"></i>
          </div>
        </div>
        <img class="img-fluid" src="img/section/BubbleMap150.png" alt="">
      </a>
      <div class="captionPortfolio">Bubble map</div>
    </div>
  </div>

</div>
</section>






<!-- ============================ CONTACT SECTION ============================ -->
<section id="contact" class="bg" style="background-color: white; padding-top: 60px">
  <div class="container">
    <div class="row">
      <div class="col-lg-2 text-center"></div>
      <div class="col-lg-8 text-center">
        <br><br><br>
        <h2 class="section-heading text-uppercase" style="color: black">Contact</h2>
        <p>This document is a work by <a href="https://www.yan-holtz.com">Yan Holtz</a>. Any feedback is highly encouraged. You can fill an issue on <a href="https://github.com/holtzy/D3-graph-gallery/issues">Github</a>, drop me a message on <a href="https://twitter.com/R_Graph_Gallery">Twitter</a>, or send an email pasting <a href="">yan.holtz.data</a> with <a href="">gmail.com</a>.</p>
        <div style="text-align:center">
           <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="https://github.com/holtzy">Github</a>
           <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="https://twitter.com/R_Graph_Gallery">Twitter</a>
         </div>
      </div>
    </div>
  </div>
</section>



<!-- ============================ FOOTER SECTION ============================ -->

    <!-- AdThrive Footer Code Start-->
    <script type="text/javascript" async src="https://btloader.com/tag?o=5698917485248512&upapi=true&domain=r-graph-gallery.com"></script>
    <script>!function(){"use strict";var e;e=document,function(){var t,n;function r(){var t=e.createElement("script");t.src="https://cafemedia-com.videoplayerhub.com/galleryplayer.js",e.head.appendChild(t)}function a(){var t=e.cookie.match("(^|[^;]+)\s*__adblocker\s*=\s*([^;]+)");return t&&t.pop()}function c(){clearInterval(n)}return{init:function(){var e;"true"===(t=a())?r():(e=0,n=setInterval((function(){100!==e&&"false" !== t || c(), "true" === t && (r(), c()), t = a(), e++}), 50))}}}().init()}();</script>
    <!-- AdThrive Footer Code End -->



<footer class="bg-light" id="myFooter">
  <div class="container" >
    <div class="row">
      <div class="col-md-4">
        <span class="copyright">Copyright &copy; the R graph gallery 2018</span>
      </div>
      <div class="col-md-4">
        <ul class="list-inline social-buttons">
          <li class="list-inline-item">
            <a href="https://twitter.com/R_Graph_Gallery">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item">
            <a href="https://github.com/holtzy">
              <i class="fa fa-github"></i>
            </a>
          </li>
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline quicklinks">
          <li class="list-inline-item">
            <a href="#">Privacy Policy</a>
          </li>
          <li class="list-inline-item">
            <a href="#">Terms of Use</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>




<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>



<!-- ============================ JAVASCRIPT SECTION ============================ -->

<!-- Bootstrap core JavaScript -->
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Custom scripts for this template -->
<script src="js/agency.min.js"></script>

</body>
</html>
